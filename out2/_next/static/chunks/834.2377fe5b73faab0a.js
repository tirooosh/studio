"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[834],{8834:(e,s,a)=>{a.r(s),a.d(s,{ReaderView:()=>D});var t=a(5155),l=a(2115),n=a(6766),r=a(965),i=a(9774),d=a(7223),o=a(3764),c=a(3300),m=a(1008),u=a(8718),h=a(9434),x=a(7481),f=a(285),p=a(6695),g=a(6424),j=a(9150),v=a(5057),w=a(2346),b=a(4636),N=a(4073);let y=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsxs)(N.bL,{ref:s,className:(0,h.cn)("relative flex w-full touch-none select-none items-center",a),...l,children:[(0,t.jsx)(N.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,t.jsx)(N.Q6,{className:"absolute h-full bg-primary"})}),(0,t.jsx)(N.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});y.displayName=N.bL.displayName;var k=a(3433),S=a(9556),A=a(7381),C=a(518);let I=k.bL;k.YJ;let z=k.WT,R=l.forwardRef((e,s)=>{let{className:a,children:l,...n}=e;return(0,t.jsxs)(k.l9,{ref:s,className:(0,h.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...n,children:[l,(0,t.jsx)(k.In,{asChild:!0,children:(0,t.jsx)(S.A,{className:"h-4 w-4 opacity-50"})})]})});R.displayName=k.l9.displayName;let P=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(k.PP,{ref:s,className:(0,h.cn)("flex cursor-default items-center justify-center py-1",a),...l,children:(0,t.jsx)(A.A,{className:"h-4 w-4"})})});P.displayName=k.PP.displayName;let E=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(k.wn,{ref:s,className:(0,h.cn)("flex cursor-default items-center justify-center py-1",a),...l,children:(0,t.jsx)(S.A,{className:"h-4 w-4"})})});E.displayName=k.wn.displayName;let F=l.forwardRef((e,s)=>{let{className:a,children:l,position:n="popper",...r}=e;return(0,t.jsx)(k.ZL,{children:(0,t.jsxs)(k.UC,{ref:s,className:(0,h.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...r,children:[(0,t.jsx)(P,{}),(0,t.jsx)(k.LM,{className:(0,h.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,t.jsx)(E,{})]})})});F.displayName=k.UC.displayName,l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(k.JU,{ref:s,className:(0,h.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...l})}).displayName=k.JU.displayName;let L=l.forwardRef((e,s)=>{let{className:a,children:l,...n}=e;return(0,t.jsxs)(k.q7,{ref:s,className:(0,h.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(k.VF,{children:(0,t.jsx)(C.A,{className:"h-4 w-4"})})}),(0,t.jsx)(k.p4,{children:l})]})});L.displayName=k.q7.displayName,l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(k.wv,{ref:s,className:(0,h.cn)("-mx-1 my-1 h-px bg-muted",a),...l})}).displayName=k.wv.displayName;var B=a(5863);let V=l.forwardRef((e,s)=>{let{className:a,value:l,...n}=e;return(0,t.jsx)(B.bL,{ref:s,className:(0,h.cn)("relative h-2 w-full overflow-hidden rounded-full bg-secondary/20",a),...n,children:(0,t.jsx)(B.C1,{className:"h-full w-full flex-1 bg-primary transition-transform",style:{transform:"translateX(-".concat(100-(l||0),"%)")}})})});V.displayName=B.bL.displayName;var $=a(704);let H=$.bL,J=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)($.B8,{ref:s,className:(0,h.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...l})});J.displayName=$.B8.displayName;let M=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)($.l9,{ref:s,className:(0,h.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...l})});M.displayName=$.l9.displayName;let T=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)($.UC,{ref:s,className:(0,h.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...l})});T.displayName=$.UC.displayName;var U=a(333);function D(e){var s;let{book:a,onOpenLibrary:N,onUpdateBook:k,isDarkMode:S,toggleDarkMode:A,fontSize:C,setFontSize:P,installPrompt:E,onInstall:B}=e,[$,D]=(0,l.useState)("stopped"),[q,W]=(0,l.useState)(1),[_,Z]=(0,l.useState)(1),[G,X]=(0,l.useState)([]),[Y,K]=(0,l.useState)(void 0),[O,Q]=(0,l.useState)(0),ee=(0,l.useRef)(null),es=(0,l.useRef)(null),{toast:ea}=(0,x.dj)(),et=(null==a?void 0:a.content.match(/[^.!?\n]+[.!?\n]*/g))||[],el=(0,l.useRef)([]),[en,er]=(0,l.useState)(0),[ei,ed]=(0,l.useState)(0),[eo,ec]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=0;el.current=et.map(s=>{let a=e;return e+=s.length,a})},[et]),(0,l.useEffect)(()=>{if(null==a?void 0:a.coverImage){let e=new window.Image;e.src=a.coverImage,e.onload=()=>{ec(e.width>e.height)}}else ec(!1)},[null==a?void 0:a.coverImage]);let em=()=>{(speechSynthesis.speaking||speechSynthesis.pending)&&speechSynthesis.cancel(),D("stopped"),ee.current=null},eu=(e,s)=>{if(a){if("pause"===e)speechSynthesis.speaking&&speechSynthesis.pause(),D("paused");else if("play"===e)if(speechSynthesis.paused)speechSynthesis.resume(),D("playing");else{let e=ei-(el.current[en]||0);eh(en,e)}else if("jump"===e){var t,l;let e=null!=(t=null==s?void 0:s.charIndex)?t:0,n=null!=(l=null==s?void 0:s.andPlay)&&l,r=el.current.findIndex(s=>s>e)-1;r<-1&&(r=el.current.length-1),r<0&&(r=0),ed(e),er(r),a.content.length>0&&Q(e/a.content.length*100),n?(em(),eh(r)):em()}}},eh=function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],!a||e>=et.length)return void D("stopped");let s=et[e]||"";if(!s||!s.trim()){let s=e+1;s<et.length?(er(s),eh(s)):D("stopped");return}let t=new SpeechSynthesisUtterance(s),l=G.find(e=>e.name===Y);l&&(t.voice=l),t.rate=q,t.pitch=_;let n=el.current[e]||0;t.onstart=()=>{D("playing"),er(e)},t.onboundary=e=>{let s=n+e.charIndex;ed(s),a.content.length>0&&Q(s/a.content.length*100)},t.onend=()=>{let s=e+1;s<et.length?eh(s):(D("stopped"),Q(100),ed(a.content.length),ee.current=null)},t.onerror=e=>{"interrupted"!==e.error&&"canceled"!==e.error&&(console.error("Speech Synthesis Error",e.error),ea({title:"Narration Error",description:"Could not play audio: ".concat(e.error),variant:"destructive"}),D("stopped"))},ee.current=t,speechSynthesis.speak(t)};(0,l.useEffect)(()=>{let e=()=>{let e=window.speechSynthesis.getVoices();if(e.length>0){X(e);let s=e.filter(e=>e.lang.startsWith("en")),a=e.find(e=>"Google UK English Male"===e.name)||e.find(e=>e.name.includes("Zira"))||s.find(e=>e.name.toLowerCase().includes("male"))||s[0]||e[0];K(null==a?void 0:a.name)}};return e(),window.speechSynthesis.onvoiceschanged=e,()=>{window.speechSynthesis.onvoiceschanged=null,em()}},[]),(0,l.useEffect)(()=>{if(es.current&&en<et.length){let e=es.current.querySelector(".sentence-highlight");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}},[en,et.length]),(0,l.useEffect)(()=>{let e=()=>em();if(!a)return Q(0),ed(0),er(0),e;let s=0;return a.bookmarks&&a.bookmarks.length>0&&(s=a.bookmarks.reduce((e,s)=>new Date(e.createdAt)>new Date(s.createdAt)?e:s).charIndex),eu("jump",{charIndex:s,andPlay:!1}),e},[a]),(0,l.useEffect)(()=>{if("playing"!==$||!a||!ee.current)return;let e=ei-(el.current[en]||0);em(),setTimeout(()=>{eh(en,e)},50)},[q,_,Y]),(0,l.useEffect)(()=>a&&"mediaSession"in navigator?(navigator.mediaSession.metadata=new MediaMetadata({title:a.title,artist:a.author,artwork:[{src:a.coverImage,sizes:"300x400",type:"image/png"}]}),navigator.mediaSession.playbackState="playing"===$?"playing":"paused",navigator.mediaSession.setActionHandler("play",()=>eu("paused"===$?"play":"pause")),navigator.mediaSession.setActionHandler("pause",()=>eu("pause")),navigator.mediaSession.setActionHandler("seekbackward",()=>{eu("jump",{charIndex:Math.max(0,ei-100),andPlay:"playing"===$})}),navigator.mediaSession.setActionHandler("seekforward",()=>{eu("jump",{charIndex:Math.min(a.content.length-1,ei+100),andPlay:"playing"===$})}),()=>{navigator.mediaSession.setActionHandler("play",null),navigator.mediaSession.setActionHandler("pause",null),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null)}):void 0,[a,$,en,et,q,_,Y,ei]);let ex=()=>{if(!a)return;let e={id:new Date().toISOString(),charIndex:ei,createdAt:new Date().toLocaleString(),previewText:a.content.substring(ei,ei+50)+"..."},s=[...a.bookmarks||[],e];k({...a,bookmarks:s}),ea({title:"Bookmark added!"})},ef=e=>{if(!a)return;let s=(a.bookmarks||[]).filter(s=>s.id!==e);k({...a,bookmarks:s}),ea({title:"Bookmark removed.",variant:"destructive"})};return(0,t.jsxs)("div",{className:"flex flex-col h-dvh bg-background",children:[(0,t.jsxs)("header",{className:"p-4 border-b flex items-center justify-between bg-card/80 backdrop-blur-sm sticky top-0 z-10 h-20 md:h-24",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)(f.$,{variant:"ghost",onClick:N,className:"flex items-center text-base p-2 -ml-2 md:p-4",children:[(0,t.jsx)(r.A,{className:"h-6 w-6 md:h-7 md:w-7 mr-1"}),(0,t.jsx)("span",{className:"hidden md:inline text-lg",children:"Back to Library"})]})}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("h2",{className:"font-semibold truncate max-w-[200px] md:max-w-md text-base md:text-xl",children:null==a?void 0:a.title})}),(0,t.jsxs)(f.$,{variant:"ghost",size:"icon",onClick:ex,className:"h-12 w-12 md:h-14 md:w-14",children:[(0,t.jsx)(i.A,{className:"h-6 w-6 md:h-7 md:w-7"}),(0,t.jsx)("span",{className:"sr-only",children:"Add Bookmark"})]})]}),(0,t.jsx)(g.F,{className:"flex-grow",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-4 md:p-6 lg:p-12",children:[(0,t.jsxs)("div",{className:(0,h.cn)("flex flex-col md:flex-row gap-6 md:gap-8 lg:gap-12 items-start mb-8",{"md:flex-row-reverse":eo}),children:[(0,t.jsx)(n.default,{src:(null==a?void 0:a.coverImage)||"",alt:"Cover of ".concat(null==a?void 0:a.title),width:eo?400:300,height:eo?300:400,className:(0,h.cn)("rounded-lg shadow-2xl object-cover mx-auto w-48 md:w-64 flex-shrink-0",eo?"aspect-video":"aspect-[3/4]"),"data-ai-hint":"book cover"}),(0,t.jsxs)("div",{className:"pt-2 md:pt-4 flex-1",children:[(0,t.jsx)("h1",{className:"font-headline text-2xl md:text-4xl lg:text-5xl font-bold",children:null==a?void 0:a.title}),(0,t.jsx)("p",{className:"text-lg md:text-2xl text-muted-foreground mt-2",children:null==a?void 0:a.author}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,t.jsx)(j.k,{fileType:(null==a?void 0:a.fileType)||"TXT"}),(0,t.jsxs)(f.$,{variant:"outline",onClick:ex,className:"hidden md:flex",children:[(0,t.jsx)(i.A,{className:"mr-2 h-4 w-4"})," Add Bookmark"]})]})]})]}),(0,t.jsx)(w.w,{className:"my-6 md:my-8"}),(0,t.jsxs)(H,{defaultValue:"content",children:[(0,t.jsxs)(J,{className:"mb-4",children:[(0,t.jsx)(M,{value:"content",children:"Content"}),(0,t.jsxs)(M,{value:"bookmarks",children:["Bookmarks ",(0,t.jsx)("span",{className:"ml-2 bg-muted text-muted-foreground rounded-full px-2 text-xs",children:(null==a||null==(s=a.bookmarks)?void 0:s.length)||0})]})]}),(0,t.jsx)(T,{value:"content",children:(0,t.jsx)("article",{ref:es,className:"prose dark:prose-invert max-w-none text-foreground/90 leading-relaxed text-base md:text-lg",style:{fontSize:"".concat(C,"%")},children:(0,t.jsx)(()=>{if(!a)return null;let e=0;return(0,t.jsx)(t.Fragment,{children:et.map((s,a)=>{let l=e;e+=s.length;let n=a===en&&"stopped"!==$;return(0,t.jsx)("span",{onClick:()=>eu("jump",{charIndex:l,andPlay:!0}),className:(0,h.cn)({"bg-accent/30 rounded sentence-highlight cursor-pointer":n,"cursor-pointer hover:bg-accent/10":!n&&s.trim().length>0}),children:s},a)})})},{})})}),(0,t.jsx)(T,{value:"bookmarks",children:(null==a?void 0:a.bookmarks)&&a.bookmarks.length>0?(0,t.jsx)("div",{className:"space-y-4",children:a.bookmarks.map(e=>(0,t.jsx)(p.Zp,{className:"overflow-hidden",children:(0,t.jsxs)(p.Wu,{className:"p-4 flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-grow",children:[(0,t.jsxs)("p",{className:"text-sm font-medium text-muted-foreground",children:["Added on ",e.createdAt]}),(0,t.jsxs)("blockquote",{className:"text-sm italic border-l-2 pl-2 mt-1",children:['"',e.previewText,'"']})]}),(0,t.jsxs)("div",{className:"flex-shrink-0 flex gap-2",children:[(0,t.jsx)(f.$,{size:"sm",variant:"outline",onClick:()=>eu("jump",{charIndex:e.charIndex,andPlay:!0}),children:"Go to"}),(0,t.jsxs)(f.$,{size:"icon",variant:"destructive",onClick:()=>ef(e.id),children:[(0,t.jsx)(d.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Delete bookmark"})]})]})]})},e.id))}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(i.A,{className:"mx-auto h-12 w-12 text-muted-foreground/50"}),(0,t.jsx)("h3",{className:"mt-4 text-lg font-semibold",children:"No Bookmarks Yet"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Click the bookmark icon while reading to save your spot."})]})})]})]})}),(0,t.jsxs)("div",{className:"p-4 border-t bg-card/80 backdrop-blur-sm sticky bottom-0 h-28 flex flex-col justify-center",children:[(0,t.jsx)("div",{className:"w-full flex items-center justify-center mb-2 px-4",children:(0,t.jsx)(V,{value:O,className:"h-2 w-full max-w-lg"})}),(0,t.jsxs)("div",{className:"max-w-lg mx-auto flex items-center justify-around gap-2 w-full",children:[(0,t.jsx)(f.$,{variant:"ghost",size:"icon",className:"h-16 w-16 md:h-20 md:w-20","aria-label":"Add Bookmark",onClick:ex,children:(0,t.jsx)(i.A,{className:"h-7 w-7 md:h-8 md:w-8"})}),(0,t.jsx)(f.$,{size:"lg",className:"rounded-full w-16 h-16 md:w-20 md:h-20",onClick:()=>eu("playing"===$?"pause":"play"),"aria-label":"playing"===$?"Pause":"Play",children:"playing"===$?(0,t.jsx)(o.A,{className:"h-8 w-8 md:h-10 md:w-10"}):(0,t.jsx)(c.A,{className:"h-8 w-8 md:h-10 md:w-10"})}),(0,t.jsxs)(b.AM,{children:[(0,t.jsx)(b.Wv,{asChild:!0,children:(0,t.jsx)(f.$,{variant:"ghost",size:"icon",className:"h-16 w-16 md:h-20 md:w-20","aria-label":"Playback Settings",children:(0,t.jsx)(m.A,{className:"h-7 w-7 md:h-8 md:w-8"})})}),(0,t.jsx)(b.hl,{className:"w-80 p-6",children:(0,t.jsxs)("div",{className:"grid gap-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"font-medium leading-none font-headline text-lg",children:"Playback Settings"}),(0,t.jsx)("p",{className:"text-base text-muted-foreground",children:"Customize your listening experience."})]}),(0,t.jsxs)("div",{className:"grid gap-4 text-base",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(v.J,{htmlFor:"dark-mode-switch",className:"text-lg",children:"Dark Mode"}),(0,t.jsx)(U.d,{id:"dark-mode-switch",checked:S,onCheckedChange:A})]}),(0,t.jsx)(w.w,{}),(0,t.jsxs)("div",{className:"grid gap-2 mt-2",children:[(0,t.jsxs)(v.J,{htmlFor:"font-size-slider",className:"text-lg",children:["Font Size (",C,"%)"]}),(0,t.jsx)(y,{id:"font-size-slider",min:50,max:200,step:10,value:[C],onValueChange:e=>{let[s]=e;return P(s)}})]}),(0,t.jsx)(w.w,{}),(0,t.jsx)(v.J,{htmlFor:"voice-select",className:"text-lg",children:"Voice"}),(0,t.jsxs)(I,{value:Y,onValueChange:K,children:[(0,t.jsx)(R,{id:"voice-select",className:"text-base",children:(0,t.jsx)(z,{placeholder:"Select a voice"})}),(0,t.jsx)(F,{children:G.map(e=>(0,t.jsxs)(L,{value:e.name,className:"text-base",children:[e.name," (",e.lang,")"]},e.name))})]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-2",children:[(0,t.jsxs)(v.J,{htmlFor:"speed-slider",className:"text-lg",children:["Speed (",q.toFixed(1),"x)"]}),(0,t.jsx)(y,{id:"speed-slider",min:.5,max:3,step:.1,value:[q],onValueChange:e=>{let[s]=e;return W(s)}})]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-2",children:[(0,t.jsxs)(v.J,{htmlFor:"pitch-slider",className:"text-lg",children:["Pitch (",_.toFixed(1),")"]}),(0,t.jsx)(y,{id:"pitch-slider",min:.5,max:2,step:.1,value:[_],onValueChange:e=>{let[s]=e;return Z(s)}})]}),E&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.w,{}),(0,t.jsxs)(f.$,{onClick:B,className:"mt-2 w-full text-base",children:[(0,t.jsx)(u.A,{className:"mr-2 h-5 w-5"})," Install App"]})]})]})]})})]})]})]})]})}}}]);